# Zone of Shadows
## Общее описание
  
Это браузерная многопользовательская игра, вдохновлённая игровой вселенной S.T.A.L.K.E.R. Действие происходит в Зоне — опасной территории, полной аномалий, мутантов и сталкеров. Игроки берут на себя роль сталкеров, исследующих локации, взаимодействующих друг с другом и с окружающей средой, сражаясь с врагами и выполняя задания.

### Основные особенности

- **Многопользовательская игра**: Поддержка взаимодействия в реальном времени через Colyseus и асинхронного обмена данными с использованием Redis и NATS.
  
- **Сеттинг**: Мрачная эстетика Зоны с аномалиями, артефактами, мутантами и другими опасностями, реализованная через сцены Phaser.js с гексагональной сеткой.
  
- **Цель**: Выживание, исследование, сбор ресурсов (артефакты, оружие) и выполнение заданий, прокачивание персонажа, торговля, участие в группировках, захват территорий в составе группировки.

- Роли: Основные — администратор, модератор, глава клана, игрок; второстепенные — редактор квестов, забаненный. Управление ролями реализовано через Supabase Auth.

- PVP и PVE: Боевая система поддерживает PvP (игрок против игрока), PvE (игрок против NPC) и PvPvE (смешанные бои). Реализовано через комнаты Colyseus с синхронизацией состояния.

- Общение: Внутриигровой чат, форум-подобный модуль в ПДА, личные сообщения, система SOS и доска объявлений — данные хранятся в Supabase, а обмен происходит через NATS.

- Торговля: Торговля между игроком и npc-торговцем, и между игроками. Можно покупать как за деньги, так и проводить бартер. Как происходит процесс бартера между игроком и торговцем-npc - игрок изначально видит ассортимент товара торговца и может набирать нужные ему товары, а в замен выкладывать свои вещи, игроку нужно добиться одинаковой стоимости вещей или уступить торговцу более дорогую вещь за его товар(+ к репутации); Бартер игрок-игрок - любой игрок может послать запрос на торговлю другому игроку(если нет запрета на запрос, который может установить игрок дабы избежать запросов торговли), если запрос принят, то игрокам даётся возможность выложить свой хабар из инвентаря и пообщаться во внутреннем чате между этими двумя игроками которые ведут торговлю.

- Группировки: В игре есть возможность сплотится в группировку с другими игроками. Каждый клан имеет свою внутреннюю систему со своими правилами и устоями, у одних может быть чёткая иерархия и система званий, а у других все равны и все существуют на равных. Так же у игроков есть возможность создать свою группировку, собрав достаточно ресурсов и желающих вступить.

- Захват и контроль территорий: Так как игра поделена на гексы, у кланов есть возможность захвата этих гексов. Процесс этот не лёгкий и требует сплочённости, ресурсов, достаточного количества людей и своевременной коммуникации внутри клана. В игре можно захватить и удерживать только определённые гексы, некоторые гексы можно удерживать на постоянной основе, а некоторые можно захватить на определённый временной участок. Так же есть нейтральные гексы, которые нельзя захватить. Захваченный гекс может приносить ресурсы если им заниматься и развивать уровень своего присутствия на гексе. Гекс так же может захватить или хотя бы попытаться это сделать другая группировка, для этого есть временные зоны для захвата, к которым группировки с обеих сторон готовятся и накапливают ресурсы для защиты или захвата. Время для возможности захвата - каждые два дня в неделю. Захватить нужно 70% подконтрольной территории, остальные 30% территории остаются за кланом который защищался ещё одни сутки. Сделано это для того, чтобы дать возможность контратаковать и захватить гекс обратно.
  
- Исследование мира: У игроков есть масса возможности разбавить свой досуг разного рода занятиями. Можно отправится на добычу артефактов, можно выполнять квесты, охотится, исследовать лаборатории и неизведанные места, быть киллером, помогать людям, быть проводником, медиком, примкнуть к клану или стать главой собственной группировки, быть торговцем, исследовать аномальные поля, работать на учёных, продавать информацию и многое другое.

- Потребности: У каждого персонажа есть личные потребности в еде, воде, сне, оружии и защитной экипировки, а так же безопасности. У персонажа игрока есть ежедневные потребности в еде, воде и сне. Каждый прожитый час в игре поднимает уровень сонливости, голода и жажды.  
 
- Инвентарь игрока: У каждого игрока при старте есть в личном профиле инвентарь(рюкзак), слоты экипировки, куда он может поместить защитную экипировку(броня, шлем), основное оружие, вспомогательное оружие, пистолет, пояс артефактов, разгрузка(если надета), нож, слот для детектора аномалий и артефактов. В инвентаре, в зависимости от используемого рюкзака, игрок может хранить свой хабар. Каждая вещь имеет вес, из-за этого у игрока есть максимально переносимый вес, при достижении которого он не может двигаться. Максимально переносимый вес зависит от рюкзака и характеристик персонажа.
  
- Характеристики персонажа: Каждый персонаж имеет группу характеристик - Здоровье, Сила, Ловкость, Скрытность, 
  
- Навыки персонажа: Каждый игрок волен прокачивать своего персонажа так как ему хочется. Поэтому в игре есть многообразие доступных к изучению навыков. Они делятся на 2 типа - активные и пассивные. Активные навыки это те что вы активируете самостоятельно, а пассивные активны постоянно. 
# Структура игрового мира

### Локации


- В игре существует несколько уровней (локаций), каждая из которых представляет собой отдельную карту с уникальной темой и набором точек интереса.
- Локации соединены точками перехода, позволяющими игрокам перемещаться между ними.
- Локации разделены на гексы, каждый гекс имеет свои точки интереса, между этими точками есть пути, а сами пути имеют контрольные точки(узлы) по которым передвигаются игроки, перемещаясь от точке к точке.

### Точки перемещения

- Механика передвижения:  
    - Игрок видит локацию, которая поделена на гексы, каждый гекс имеет свои точки интереса, между этими точками есть пути, а сами пути имеют контрольные точки(узлы) по которым передвигаются игроки, перемещаясь от точке к точке.
    - Клик по точке инициирует показ возможных вариантов путей(минимум 1 путь). Каждый путь проходит от начальной точки(где находится игрок) до конечной точки(куда кликнул игрок), путь имеет контрольные точки(узлы), которые последовательно нужно пройти в обязательном порядке без возможности как то миновать один или несколько узлов и оказаться сразу на конечной точке. На каждой точке может быть своё событие(встреча с мутантом, аномальная ловушка и тп.). Двигаясь по пути, игрок имеет право вернутся обратно по тем же узлам что и пришёл.
    - Перемещение сопровождается затратами времени/энергии, а так же может привести к случайным событиями (например, встреча с мутантом).
    - При клике на желаемую точку перехода, появляются все доступные пути до этой точки. Активный путь на который наводится курсор - подсвечивается. Все пути на которых не наведён курсор - отсаются дефолтного цвета.
    - Клик на одни из предложеных путей, запускает анимацию перемещения на первый узел пути, выбранный путь остаётся видимым, а остальные пути скрываются, далее игрок может перемещаться по пути, кликнув на следующий узел пути.
    - Игрок не может миновать следующий узел пути, путь проходится либо вперёд либо назад строго последовательно.
    - Если игрок кликнул на узел пути, который уже пройден, то игрок сможет вернуться назад по этому пути до начальной точки.

- Каждая точка уникальна и имеет:  
    - **Название**: Например, "Бар 100 рентген", "Аномалия Жарка", "Свалка" и другие.
    - **Coordinates**: Координаты точки на гексагональной сетке.
    - **Тип**: Определяет её функциональность:  
        - **Лагерь сталкеров**: Безопасная зона для торговли, отдыха, общения.
        - **Точка перехода**: В зависимости от конечного пункта, позволяет переместиться на другую локацию, другой гекс или спуститься в лабораторию.
        - **Обычная точка:** Обычная точка где может быть всё что угодно - от вражеского патруля до аномального поля
        - **Аномальное поле:** Точка скопления аномалий, тут можно попробовать обнаружить и достать артефакт.
        - **Точка группировки:** Отдельная категория точек, которыми управляет и контролирует группировка. Тут может быть склад, стрельбище, арсенал, блокпост, штаб и т.п.
    - **Description**: Описание точки, которое будет видно игроку при наведении на точку.
    - **Parameters**: События, которые могут произойти на точке.

- Пути точек:
    - Пути создаются между точками и состоят из узлов.
    - Узлы пути можно перемещать, удалять и добавлять.
    - Узлы пути можно настроить так же как и точки, добавить события и возможные действия для игроков.

- Каждый путь имеет:
    - **Начальную точку** - откуда начинается путь.
    - **Конечную точку** - где заканчивается путь.
    - **Узлы** - точки которые наполняют путь.
    - **Параметры** - параметры узлов пути с указанием событий которые могут произойти на узле.

- Как добавляются новые точки и пути:
  - Администратор использует специальный интерфейс в игре для управления картой
  - Для добавления новой точки:
    1. Выбирает гекс на котором будет находится точка
    2. Выбирает тип точки (лагерь, аномалия, переход и т.д.)
    3. Указывает координаты на гексагональной сетке методом клика внутри изменяемого гекса
    4. Заполняет метаданные (название, описание, параметры)
    5. Настраивает доступные действия для игроков, а так же возможные события на точке
    6. Сохраняет изменения, которые сразу синхронизируются с Supabase
  - Для создания путей:
    1. Выбирает начальную затем конечную точки
    2. Кликает на место на карте где будет расположен первый узел пути, далее кликает на место где будет расположен следующий узел пути и так до тех пор пока не будет создан весь путь, в конце кликает на конечную точку пути
    3. Путь создаётся, сохраняется в localStorage и остаётся видимым на карте
    4. Теперь путь можно настроить, кликнув по любому узлу пути и настроить параметры пути(стоимость, опасность, события)
    5. Сохраняет путь, который становится доступным для игроков
  - Редактирование существующих точек:
    - Изменения применяются в реальном времени
    - Клик по любой точке загружает информацию с параметрами этой точки в блок свойств
    - Зажав на левую кнопку мыши на точке и перемещая её можно изменить местоположение точки на карте с помощью Drag&Drop react.
    - Клик по кнопке "Сохранить изменения" сохраняет изменения
    - Клик по кнопке "Удалить точку" удаляет точку
    - Клик по кнопке "Отмена" отменяет изменения
  - Редактирование существующих путей:
    - Клик по любому пути загружает информацию с параметрами этого пути в блок свойств
    - Зажав на левую кнопку мыши на любом узле пути и перемещая его можно изменить местоположение узла в пути с помощью Drag&Drop react.
    - Для того чтобы удалить узел нужно кликнуть по нему левой кнопкой мыши и нажать кнопку "Удалить" в блоке свойств
    - Клик по кнопке "Сохранить изменения" сохраняет изменения
    - Клик по кнопке "Удалить путь" удаляет путь
    - Клик по кнопке "Отмена" отменяет изменения
  - Интерфейс включает:
    - Визуальный редактор карты с drag-and-drop функционалом
    - Панель свойств для настройки параметров точек и путей с возможностью сохранения, удаления и отмены изменений
    - Щелчок по любой точке или пути загружает информацию с параметрами этой точки или пути в блок свойств
  - Техническая реализация:
    - Данные хранятся в Supabase в таблицах:
      * points_of_interest (id, name, coordinates, type, description, parameters)
      * paths (id, start_point, end_point, nodes, parameters)
    - API для CRUD операций:
      * POST /api/points - создание новой точки
      * PUT /api/points/:id - редактирование точки
      * DELETE /api/points/:id - удаление точки
      * Аналогичные эндпоинты для путей
    - Реактивная синхронизация через Supabase Realtime
  - Безопасность:
    - Доступ только для пользователей с ролью admin
    - Валидация всех изменений на сервере
  - Дополнительные функции:
    - Возможность сохранить шаблон для быстрого создания типовых точек


## Игровая механика

### Взаимодействие игроков

- Игроки могут:  
    - **Общаться**: через чат или предустановленные команды (например, "Нужна помощь!").
    - **Торговать**: обмениваться артефактами, оружием или патронами в лагерях.
    - **Сражаться**: PvP возможно в определённых зонах (например, за контроль над точкой с артефактом). 
    - **Объединяться**: создавать группы для совместного прохождения опасных зон.
    - **Вступать в группировки**: вступать в группировки близких по духу и целям.
    - **Выполнять квесты**: выполнять квесты кланов, выполнять квесты в одиночку или в группе с другими игроками.
    - **Исследовать аномальные поля**: исследовать аномальные поля для нахождения артефактов.
    - **Исследовать лаборатории**: исследовать лаборатории для нахождения секретных вещей.
    - **Исследовать другие локации**: исследовать другие локации игры.
    
### Взаимодействие с NPC

- **Дружественные NPC**:  
    - Торговцы в лагерях предлагают покупку/продажу предметов.
    - Квестодатели выдают задания (например, "Добудь артефакт из аномалии").
    - Проводники помогают перемещаться между локациями.
    - Медики помогают восстановить здоровье и энергию.
    - Учёные помогают исследовать лаборатории и аномальные поля, а так же продают научные товары.
    - Разведчики помогают исследовать другие локации игры.
    
- **Враждебные NPC**:  
    - Мутанты (собаки, контроллёры, кровососы) атакуют при приближении к их местам обитания.
    - Бандиты или военные сталкеры могут охранять ценные ресурсы или патрулировать отдельные точки.

### Боевая система

- Бои с мутантами или NPC происходят при входе в определённые точки или узлы пути.
  
- Механика боя:  
    - Пошаговая мини-игра, с игровым полем разделённым на гексы, размер игрового поля может быть разным и зависит от настроек конкретного боя которые задаёт админ при создании боевого события или же с заранее определёнными размерами. 
    
	- Размеры игрового поля: малое - 20 гексов(1-3 врага), среднее - 35 гексов(4-8 врагов), большое - 60 гексов(9 и более врагов).
      
    - Игрок использует оружие, экипировку и другие предметы из инвентаря которые могут помочь ему в бою.
    
	- На игровом поле есть несколько типов препятствий(забор, ямы, аномалии), случайных событий(появление мутанта или невидимая аномалия), вспомогательных элементов окружения(заборы, автомобили, ящики, платформы с лестницами). Так или иначе игрок может использовать их в своих целях, например, можно залезть на автомобиль чтобы избежать прямого столкновения с мутантом, или заманить мутанта в аномалию встав таким образом чтобы аномалия оказалась между игроком и мутантом, или скрыться в высоких кустах чтобы противник потерял игрока из виду.
	  
	- Каждое действие на поле будь то передвижение, выстрел или перезарядка - тратит определённое количество очков действий(ОД) в зависимости от типа действия.
       
  
- Возможные исходы:  
    - Победа: получение добычи (патроны, артефакты).
      
    - Поражение: потеря здоровья, ресурсов + перемещение в последний безопасный лагерь который посещал игрок.
    
  